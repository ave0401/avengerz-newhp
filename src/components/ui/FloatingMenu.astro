---
// src/components/ui/FloatingMenu.astro
const menuItems = [
  { label: "HOME", href: "/", icon: "home" },
  { label: "SERVICE", href: "/service", icon: "service" },
  { label: "COMPANY", href: "/company", icon: "company" },
  { label: "NEWS", href: "/news", icon: "news" },
  { label: "RECRUIT", href: "/recruit", icon: "recruit" },
  { label: "CONTACT", href: "/contact", icon: "contact" },
];
---

<div id="floating-menu-container" class="flex flex-col items-center gap-3">
  <div id="menu-panel" class="menu-panel-wrapper w-64 rounded-2xl overflow-hidden mb-2">
    <div class="menu-panel p-2 rounded-2xl bg-[#141417]/95 backdrop-blur-md border border-white/10 shadow-2xl">
      <div class="px-4 py-3 border-b border-white/10 text-xs font-bold text-white/40 tracking-widest uppercase font-heading">
        Navigation
      </div>
      <div class="py-2 space-y-0.5">
        {menuItems.map((item) => (
          <a href={item.href} class="menu-item flex items-center justify-between px-4 py-2.5 rounded-lg text-sm font-medium text-zinc-400 hover:text-white hover:bg-white/5 transition-colors">
            {item.label}
            <span class="opacity-70">
               <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 18l6-6-6-6"/>
               </svg>
            </span>
          </a>
        ))}
      </div>
      <div class="mt-1 px-1">
        <button id="close-menu" class="w-full flex items-center justify-center py-2 rounded-lg text-white/50 hover:text-white/90 cursor-pointer transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <button id="menu-trigger" class="menu-trigger flex items-center gap-3 pl-6 pr-6 py-3 rounded-full text-sm font-bold tracking-wide cursor-pointer font-heading bg-[#18181b] text-white shadow-lg active:scale-95 transition-transform">
    <span>Menu</span>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-80">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </button>
</div>

<style>
  /* コンテナ全体: 基本はクリック通す */
  #floating-menu-container {
    position: fixed;
    bottom: 32px;
    left: 50%;
    z-index: 50;
    transform: translateY(20px) translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
    pointer-events: none; /* 重要: ここは常に none */
    width: max-content;
    max-width: 90vw;
  }

  /* スクロールして表示された状態 */
  #floating-menu-container.visible {
    opacity: 1;
    transform: translateY(0) translateX(-50%);
    /* visibleになってもコンテナ自体はクリック通す */
    pointer-events: none;
  }

  /* === メニューパネルのラッパー === */
  .menu-panel-wrapper {
    transition: all 0.2s ease;
    transform-origin: bottom center;

    /* 閉じてる時の状態 */
    opacity: 0;
    transform: translateY(10px) scale(0.98);
    pointer-events: none; /* 重要: 閉じてる時はクリック無効 */
    visibility: hidden;   /* 重要: 閉じてる時は描画判定ごと消す */
  }

  /* 開いてる時の状態 */
  .menu-panel-wrapper.open {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto; /* 重要: 開いてる時だけクリック有効 */
    visibility: visible;
  }

  /* パネル本体 */
  .menu-panel {
    /* ここに pointer-events: auto を書かない！ラッパーに従わせる */
  }

  /* === トリガーボタン === */
  .menu-trigger {
    pointer-events: auto; /* ボタンは常にクリック有効 */
    transition: 0.1s;
  }
  .menu-trigger:active {
    transform: scale(0.95);
  }
  .menu-trigger.opacity-0 {
    opacity: 0;
    pointer-events: none; /* 消えてる時は押せない */
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const menuTrigger = document.getElementById("menu-trigger");
    const menuPanel = document.getElementById("menu-panel");
    const closeMenuBtn = document.getElementById("close-menu");

    if(menuTrigger && menuPanel && closeMenuBtn) {
      menuTrigger.addEventListener("click", (e) => {
        e.stopPropagation();
        menuPanel.classList.toggle("open");
        menuTrigger.classList.toggle("opacity-0");
      });

      closeMenuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        menuPanel.classList.remove("open");
        menuTrigger.classList.remove("opacity-0");
      });

      document.addEventListener("click", (e) => {
        if (!menuPanel.contains(e.target as Node) && !menuTrigger.contains(e.target as Node)) {
          menuPanel.classList.remove("open");
          menuTrigger.classList.remove("opacity-0");
        }
      });
    }
  });
</script>