---
// src/layouts/Layout.astro
import '../styles/global.css';
import FloatingMenu from '../components/ui/FloatingMenu.astro';
import LogoContainer from '../components/ui/LogoContainer.astro';

interface Props {
	title: string;
	description?: string;
    isHome?: boolean; // トップページのみスクロール挙動を変えるためのフラグ
}

const { title, description = "株式会社アベンジャーズは、バックオフィス支援とIT導入で企業のポテンシャルを最大化するプロフェッショナルチームです。", isHome = false } = Astro.props;
---

<!doctype html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
          href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Sans+JP:wght@400;500;700;900&family=Outfit:wght@500;700;800&display=swap"
          rel="stylesheet"
        />

		<title>{title}</title>

        <script type="application/ld+json" is:inline>
          {
            "@context": "https://schema.org",
            "@type": "Corporation",
            "name": "株式会社アベンジャーズ",
            "url": "https://avengerz-japan.com",
            "logo": "https://avengerz-japan.com/logo.png",
            "description": "バックオフィス支援とIT導入で企業のポテンシャルを最大化するプロフェッショナルチーム",
            "address": {
                "@type": "PostalAddress",
                "streetAddress": "恩納村谷茶1919-1 OISTインキュベーターセンター",
                "addressLocality": "国頭郡",
                "addressRegion": "沖縄県",
                "postalCode": "904-0495",
                "addressCountry": "JP"
            }
          }
        </script>
	</head>
	<body>
        <LogoContainer />

		<slot />

        <FloatingMenu />

        <script define:vars={{ isHome }}>
          document.addEventListener("DOMContentLoaded", () => {
            // Scroll & Reveal Logic
            const logoContainer = document.getElementById("logo-container");
            const floatingMenu = document.getElementById("floating-menu-container");
            const reveals = document.querySelectorAll(".reveal");

            // Reveal Animation Function
            const revealOnScroll = () => {
              const windowHeight = window.innerHeight;
              const elementVisible = 50;
              reveals.forEach((reveal) => {
                const rect = reveal.getBoundingClientRect();
                if (rect.top < windowHeight - elementVisible) {
                  reveal.classList.add("active");
                }
              });
            };

            // Main Scroll Handler
            window.addEventListener("scroll", () => {
              const scrollY = window.scrollY;

              // Top Page Specific Logic for Logo/Menu appearance
              if (isHome) {
                 if (scrollY > 150) {
                    floatingMenu?.classList.add("visible");
                    logoContainer?.classList.add("visible");
                  } else {
                    floatingMenu?.classList.remove("visible");
                    logoContainer?.classList.remove("visible");
                    // Close menu logic handles inside FloatingMenu component
                  }
              } else {
                  // Sub pages: Always show (or adjust threshold)
                  // 今回のデザインでは下層ページもスクロールしてから表示するパターンか、
                  // 最初から表示するか選択可能です。元のHTML(company.html等)を見ると
                  // 下層ページにはスクロール判定ロジックがHTML内に書かれていませんが、
                  // デザイン統一のため、あるいは初期表示のためにここを調整します。
                  // 元のCSSでは #logo-container は opacity:0 スタートのようなので、
                  // 下層ページは最初から表示する処理を入れます。

                  floatingMenu?.classList.add("visible");
                  logoContainer?.classList.add("visible");
              }

              revealOnScroll();
            });

            // Initial Check
            revealOnScroll();
            if (!isHome) {
                floatingMenu?.classList.add("visible");
                logoContainer?.classList.add("visible");
            }
          });
        </script>
	</body>
</html>