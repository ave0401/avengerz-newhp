---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
// MicroCMS取得関数をインポート
import { getNews } from '../lib/microcms';

// ニュースを取得（最新4件）
const response = await getNews({ limit: 4 });
const news = response.contents;
---

<Layout title="AVENGERZ - Your Next Partner" isHome={true}>
  <div id="hero-section" class="flex flex-col items-center justify-center h-screen w-full fixed top-0 left-0 z-0 px-5 will-change-opacity">
    <div
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-150 h-150 bg-indigo-100/30 rounded-full blur-[120px] pointer-events-none"
    ></div>
    <div class="text-center px-6 relative z-10 max-w-5xl mx-auto">
      <div
        class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/80 border border-gray-100 shadow-sm mb-10 backdrop-blur-sm"
      >
        <span
          class="w-1.5 h-1.5 rounded-full bg-blue-600 animate-pulse"
        ></span>
        <span
          class="text-[10px] font-bold tracking-widest text-gray-500 uppercase font-heading"
          >Your Next Partner</span
        >
      </div>
      <h1
        class="text-5xl md:text-7xl lg:text-8xl font-black text-gray-900 leading-[1.1] tracking-tight mb-8"
      >
        経営を<span
          class="text-[#4E80EE]"
          >“ギアチェンジ”</span
        ><br />
        次の<span
          class="text-[#4E80EE]"
          >“一歩”</span
        >へ
      </h1>
      <p
        class="text-xl md:text-2xl font-bold text-gray-700 mb-8 font-heading tracking-wide"
      >
        Shift your business into gear and take the next step.
      </p>
      <p
        class="text-gray-500 text-sm md:text-base leading-relaxed max-w-2xl mx-auto font-medium"
      >
        株式会社アベンジャーズは、バックオフィス支援とIT導入で<br
          class="hidden md:inline"
        />
        企業のポテンシャルを最大化するプロフェッショナルチームです。<br />
        経営者が本業に熱中できる環境を、私たちが創ります。
      </p>
    </div>
  </div>

  <div id="content-layer" class="relative z-10 mt-[100vh] pt-30 pb-40 bg-linear-to-b from-transparent via-[#f5f5f7_15%] to-[#f5f5f7] pointer-events-none">
    <div class="grid-container pointer-events-auto grid grid-cols-1 md:grid-cols-4 gap-6 max-w-275 mx-auto px-6 auto-rows-[minmax(220px,auto)] md:auto-rows-[220px]">

      <a
        href="/service"
        class="bento-card col-span-1 md:col-span-2 p-8 flex flex-col justify-center items-center group bg-white relative z-10"
      >
        <div class="absolute top-6 right-6">
          <div class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full border border-yellow-200 text-[10px] font-bold uppercase tracking-wide font-heading">
            Check This
          </div>
        </div>

        <div class="flex flex-col items-center gap-4 transition-transform duration-300 group-hover:scale-105">
          <div class="text-gray-900 bg-gray-50 p-3 rounded-xl border border-gray-100 group-hover:bg-yellow-50 group-hover:border-yellow-100 group-hover:text-yellow-600 transition-colors">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <polygon points="12 2 2 7 12 12 22 7 12 2" />
              <polyline points="2 17 12 22 22 17" />
              <polyline points="2 12 12 17 22 12" />
            </svg>
          </div>
          <h2 class="text-3xl font-bold text-gray-900 font-heading">Service</h2>
        </div>
      </a>

      <a
        href="/company"
        class="bento-card p-6 flex flex-col justify-center items-center text-center group relative z-10"
      >
        <div class="flex flex-col items-center gap-4 transition-transform duration-300 group-hover:scale-105">
           <div class="text-gray-900 bg-gray-50 p-3 rounded-xl border border-gray-100 group-hover:bg-violet-50 group-hover:border-violet-100 group-hover:text-violet-600 transition-colors">
              <svg
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <rect x="4" y="2" width="16" height="20" rx="2" ry="2" />
                <path d="M9 22v-4h6v4" />
                <path d="M8 6h.01" />
                <path d="M16 6h.01" />
                <path d="M8 10h.01" />
                <path d="M16 10h.01" />
                <path d="M8 14h.01" />
                <path d="M16 14h.01" />
              </svg>
           </div>
           <h3 class="text-3xl font-bold text-gray-900 font-heading">Company</h3>
        </div>
      </a>

      <div
        class="bento-card row-span-2 bg-white flex flex-col overflow-hidden group relative z-0"
      >
        <div
          class="p-6 border-b border-gray-50 flex items-center justify-between sticky top-0 bg-white/95 backdrop-blur z-10"
        >
          <a href="/news" class="flex items-center gap-2 group/news-header cursor-pointer">
            <span
              class="text-xs font-bold text-gray-400 uppercase tracking-widest font-heading transition-colors duration-300 group-hover/news-header:text-[#4E80EE]"
              >News Feed</span
            >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-[#4E80EE] opacity-0 -translate-x-2 transition-all duration-300 group-hover/news-header:opacity-100 group-hover/news-header:translate-x-0"
            >
              <path d="M5 12h14"></path>
              <path d="m12 5 7 7-7 7"></path>
            </svg>
          </a>
          <div class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
        </div>

        <div class="flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar relative z-0">
          {news.length === 0 ? (
            <div class="flex flex-col items-center justify-center h-full text-gray-400 py-8">
               <p class="text-xs">No updates yet.</p>
            </div>
          ) : (
            news.map((item: any) => (
              <a
                href={`/news/${item.id}`}
                class="block p-4 rounded-xl hover:bg-gray-50 transition-colors"
              >
                <span class="text-[10px] text-gray-400 font-mono mb-1 block">
                  {new Date(item.publishedAt || item.createdAt).toLocaleDateString("ja-JP", {
                    year: "numeric",
                    month: "2-digit",
                    day: "2-digit",
                  }).replace(/\//g, ".")}
                </span>
                <p class="text-sm font-bold text-gray-900 leading-snug line-clamp-2">
                  {item.title}
                </p>
              </a>
            ))
          )}
        </div>

        <div
          class="absolute bottom-0 left-0 w-full h-12 bg-linear-to-t from-white to-transparent pointer-events-none z-10"
        ></div>
      </div>

      <div
        class="bento-card col-span-1 md:col-span-2 p-8 flex flex-col justify-center items-center group bg-white relative overflow-hidden z-20"
      >
        <div class="absolute top-6 right-6 pointer-events-none">
          <div class="flex items-center gap-2">
             <span class="relative flex h-2.5 w-2.5">
               <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-pink-400 opacity-75"></span>
               <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-pink-500"></span>
             </span>
             <span class="text-[10px] font-bold text-pink-500 font-heading tracking-wide">WE ARE HIRING!</span>
          </div>
        </div>

        <div class="flex flex-col items-center gap-4 transition-transform duration-300 group-hover:scale-105 pointer-events-none">
          <div class="text-gray-900 bg-gray-50 p-3 rounded-xl border border-gray-100 group-hover:bg-pink-50 group-hover:border-pink-100 group-hover:text-pink-600 transition-colors">
             <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
             </svg>
          </div>
          <h2 class="text-3xl font-bold text-gray-900 font-heading">Recruit</h2>
        </div>

        <a
          href="/recruit"
          class="absolute inset-0 z-10"
          aria-label="Go to Recruit"
        ></a>
      </div>

      <a
        href="/contact"
        class="bento-card p-6 flex flex-col justify-center items-center text-center group relative z-50 isolate border-none shadow-md transition-all duration-300 hover:shadow-[0_0_25px_rgba(78,128,238,0.6)] hover:brightness-105"
        style="background-color: #4E80EE;"
      >
        <div class="flex flex-col items-center gap-4 transition-transform duration-300 group-hover:scale-105">
           <div class="text-white/90 group-hover:text-white transition-colors duration-300">
             <svg
               width="32"
               height="32"
               viewBox="0 0 24 24"
               fill="none"
               stroke="currentColor"
               stroke-width="1.5"
             >
               <path
                 d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
               />
               <polyline points="22,6 12,13 2,6" />
             </svg>
           </div>
           <h3 class="text-3xl font-bold text-white font-heading">
             Contact
           </h3>
        </div>
      </a>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const heroSection = document.getElementById("hero-section");

      if (heroSection) {
        window.addEventListener("scroll", () => {
          const scrollY = window.scrollY;
          const heroHeight = window.innerHeight;

          // アニメーション計算
          const fadeRatio = Math.min(scrollY / (heroHeight * 0.8), 1);
          const scaleRatio = 1 - (scrollY / heroHeight) * 0.15;

          heroSection.style.opacity = (1 - fadeRatio).toString();
          heroSection.style.transform = `scale(${scaleRatio})`;

          // パフォーマンス最適化
          if (scrollY > heroHeight) {
            heroSection.style.visibility = "hidden";
          } else {
            heroSection.style.visibility = "visible";
          }
        });
      }
    });
  </script>
</Layout>